% mini theme

% options
\newif\if@sectionpage
\@sectionpagefalse
\DeclareOption{sectionpage}{\@sectionpagetrue}
\ProcessOptions


% packages
\usepackage[none]{hyphenat}
\usepackage{etex}
\usepackage[utf8]{inputenc}
%%\usepackage[spanish]{babel}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{graphicx}
\usepackage{microtype}
\usepackage{hyperref} % links
\usepackage{pstricks,pst-grad}
\usepackage[percent]{overpic}
\usepackage{tikz}
\usetikzlibrary{arrows,shapes,shadows,positioning}
\usetikzlibrary{calc}

\renewcommand{\arraystretch}{1.5}
\setbeamersize{text margin left=0.2cm}
\setbeamersize{text margin right=0.2cm}

% define colours
\definecolor{MiniRed}{RGB}{230,37,52}
\definecolor{MiniBlack}{HTML}{353131}
\definecolor{MiniBlue}{HTML}{16AFCF}
\definecolor{MiniWhite}{HTML}{FFFFFF}
\definecolor{MiniGrey}{HTML}{565858}
\definecolor{MiniLightGrey}{HTML}{DEE0E1}

%% fonts
%\usepackage{sourceserifpro}
%\usepackage{sourcesanspro}
%\usepackage{sourcecodepro}

\renewcommand\mathfamilydefault{\rmdefault}
\renewcommand\familydefault{\rmdefault}
\setbeamerfont{title}{family*={fouriernc}, size=\fontsize{30}{32}}
\setbeamerfont{author}{family*={fouriernc}, size=\large}
\setbeamerfont{block title}{size*={8}{0}, family*={fouriernc}}
\setbeamerfont{block body}{size*={8}{0}, family*={fouriernc}}

% set colours
%% \setbeamercolor{itemize item}{fg=MiniBlue}
\setbeamercolor{enumerate item}{fg=MiniBlue}
\setbeamercolor{alerted text}{fg=MiniBlue}
\setbeamercolor{section in toc}{fg=MiniBlack}

% set fonts
\setbeamerfont{itemize/enumerate body}{size=\normalsize}
\setbeamerfont{itemize/enumerate subbody}{size=\normalsize}
\setbeamerfont{itemize/enumerate subsubbody}{size=\small}

% make the itemize bullets pixelated >
\setbeamertemplate{itemize item}{
  \tikz{
    \draw[fill=MiniRed,draw=none] (0, 0) rectangle (0.05, 0.05);
    \draw[fill=MiniRed,draw=none] (0.05, 0.05) rectangle (0.10, 0.10);
    \draw[fill=MiniRed,draw=none] (0, 0.10) rectangle (0.05, 0.15);
    }
}

%% make the subitems also pixelated >, but a little smaller and gray
\setbeamertemplate{itemize subitem}{
    \tikz{
        \draw[fill=MiniGrey,draw=none] (0, 0) rectangle (0.05, 0.05);
        \draw[fill=MiniGrey,draw=none] (0.05, 0.05) rectangle (0.10, 0.10);
        \draw[fill=MiniGrey,draw=none] (0, 0.10) rectangle (0.05, 0.15);
    }
}

\setbeamercolor{block title}{bg=MiniLightGrey,fg=MiniBlack}
\setbeamercolor{block body}{bg=MiniLightGrey,fg=MiniBlack}

\setbeamertemplate{block begin}{%
  \vspace*{1ex}
  \begin{beamercolorbox}[%
    ht=2.4ex,
    dp=1ex,
    leftskip=1ex,
    rightskip=2ex]{block title}
    \usebeamerfont{block title}\insertblocktitle%
  \end{beamercolorbox}%
  \vspace*{-2pt}
  \begin{beamercolorbox}[%
    dp=1ex,
    leftskip=1ex,
    rightskip=1ex,
    vmode]{block body}%
    \usebeamerfont{block body}%
}
\setbeamertemplate{block end}{%
  \end{beamercolorbox}
 \vspace*{0.2ex}
}

% disable navigation
\setbeamertemplate{navigation symbols}{}

% custom draw the title page above
\setbeamertemplate{title page}{}

% again, manually draw the frame title above
\setbeamertemplate{frametitle}{}

% disable "Figure:" in the captions
\setbeamertemplate{caption}{\tiny\insertcaption}
\setbeamertemplate{caption label separator}{}

% use \makeatletter for our progress bar definitions
\makeatletter
\newcount\progressbar@tmpcounta % auxiliary counter
\newcount\progressbar@tmpcountb % auxiliary counter
\newdimen\progressbar@pbwidth % progressbar width
\newdimen\progressbar@tmpdim % auxiliary dimension

\newdimen\slidewidth % auxiliary dimension
\newdimen\slideheight % auxiliary dimension

% make the progress bar go across the screen
\progressbar@pbwidth=\the\paperwidth
\slidewidth=\the\paperwidth
\slideheight=\the\paperheight

\setbeamertemplate{footline}{
  \progressbar@tmpcounta=\insertframenumber
  \progressbar@tmpcountb=\inserttotalframenumber
  \progressbar@tmpdim=\progressbar@pbwidth
  \multiply\progressbar@tmpdim by \progressbar@tmpcounta
  \divide\progressbar@tmpdim by \progressbar@tmpcountb

  \begin{tikzpicture}

    \draw[fill=MiniGrey,draw=none] (0cm,0cm) rectangle (\slidewidth,0.05cm);
    \draw[fill=MiniBlue,draw=none] (0cm,0cm) rectangle (\progressbar@tmpdim,0.05cm);

    %%\node[anchor=south west,color=MiniGrey,font=\tiny] at (0cm,0.075cm) {\insertsection\par};
    \node[anchor=south east,color=MiniGrey,font=\tiny] at (\slidewidth,0.075cm) {\insertframenumber/\inserttotalframenumber};
  \end{tikzpicture}
}
\makeatother

\setbeamertemplate{headline}{}
\setbeamertemplate{frametitle}{
  \begin{tikzpicture}
    % title bar
    \fill[color=MiniWhite] (0cm, \slideheight-1cm) rectangle (\slidewidth,\slideheight);
    \node[anchor=north west,text width=\slidewidth-1cm,font=\huge\bf,inner ysep=0.25cm,color=MiniBlack] at (0,\slideheight) {\insertframetitle};
  \end{tikzpicture}
}


\makeatletter
\setbeamertemplate{title page}{%
  \hspace*{-\beamer@leftmargin}%
  \begin{tikzpicture}
    % set up the entire slide as the canvas
    \useasboundingbox (0,0) rectangle (\slidewidth,\slideheight);

    % the background
    \fill[color=MiniWhite] (0,0) rectangle(\the\paperwidth,\the\paperheight);

    % draw the actual text
    \node[anchor=south west,text width=\slidewidth-1cm,inner sep=0, outer sep=0, font=\fontsize{30}{34}\selectfont\bf, color=MiniBlack] at (0.5cm,5cm) {\baselineskip=1cm\inserttitle\par};

    %% \fill[MiniBlue] (0.5cm,4cm) rectangle (\slidewidth-0.5cm, 4.05cm);

    \ifx\author\@empty\else
    \node[anchor=south west,align=left,color=MiniBlack,font=\normalsize] at (0.5cm,3cm) {\insertauthor};
    \fi
    \ifx\insertinstitute\@empty\else
    \node[anchor=south west,align=left,color=MiniBlack] at (0.5cm,1.5cm) {\insertinstitute};
    \fi
    \ifx\insertshortdate\@empty\else
    \node[anchor=south west,align=left,color=MiniBlack] at (0.5cm,1.0cm) {\insertshortdate};
    \fi
    \ifx\insertdate\@empty\else
    \node[anchor=south west,align=left,color=MiniBlack] at (0.5cm,0.5cm) {\insertdate};
    \fi
    \ifx\inserttitlegraphic\@empty\else
    \node[anchor=south east] at(\slidewidth-1cm,1cm) {\inserttitlegraphic};
    \fi
  \end{tikzpicture}%
}
\makeatother


% add section titles
%\if@sectionpage
\AtBeginSection{\frame{\sectionpage}}
\setbeamertemplate{section page}
{
   \begin{tikzpicture}
     \useasboundingbox (0,0) rectangle (\slidewidth,\slideheight);
     \fill[color=MiniGrey] (-1cm, 0.5\slideheight-1cm) rectangle (\slidewidth, 0.5\slideheight+1cm);
     \node[anchor=west,text width=\slidewidth-1cm,font=\Huge\bf,color=MiniWhite] at (0.5cm, 0.5\slideheight) {\insertsection};
   \end{tikzpicture}
 }
%% \else
%% \relax
%% \fi

% new environments
\renewenvironment{column} %%[1][0.5]
{\begin{minipage}[t][5cm][c]{0.5\textwidth}
    \centering
}
{
  \end{minipage}%%
}

% -----------------
%  Custom commands
% -----------------
%\newcommand{\boxd}[2]{\begin{center}\psframebox[linewidth=.1mm,linecolor=mcolor,framesep=0.5em]{\begin{minipage}[t][]{#1\textwidth}#2\end{minipage}} \end{center}}
\newcommand{\centered}[1]{\begin{center} #1 \end{center}}
\newcommand{\cheader}[1]{\begin{center} \large \bf \color{sgray} #1 \end{center}}
\newcommand{\ptitle}[1]{\begin{flushleft}{\large \bf #1}\end{flushleft}}
\newcommand{\onlytitle}[1]{\begin{center} \fontsize{5cm}{1em}\selectfont \bf \color{sgray} #1 \end{center}}
\newcommand{\oneitem}[1]{\begin{itemize} \item #1 \end{itemize}}
\newcommand{\colorarrow}{{\color{MiniBlue}\ensuremath{\to}}}
\newcommand{\beginbackup}{\begin{frame}\onlytitle{Backup}\end{frame}}
\newcommand{\hr}{\begin{center} \line(1,0){350} \end{center}}
\newcommand{\img}[2]{\includegraphics[width=#1\textwidth]{#2}}
\newcommand{\overimg}[4]{\begin{overpic}[width=#1\textwidth]{#2} \put(#3){\tiny #4} \end{overpic}}
\newcommand{\vsp}{\vspace{0.5cm}}
\newcommand{\ivsp}{\vspace{-0.5cm}}
\newcommand{\titlesp}{\vspace{1cm}}
\newcommand{\link}[1]{\href{#1}{\color{MiniBlue}\textsc{link}}}

% -------------
%  Tikz shapes
% -------------
\newcommand{\redrectangle}[1]{\tikz[baseline] \node[rectangle,thick,fill=red!30,anchor=base]{#1};}
\newcommand{\bluerectangle}[1]{\tikz[baseline] \node[rectangle,thick,fill=mcolor!30,anchor=base]{#1};}
\newcommand{\greenrectangle}[1]{\tikz[baseline] \node[rectangle,thick,fill=green!30,anchor=base]{#1};}
\newcommand{\grayrectangle}[1]{\tikz[baseline] \node[rectangle,thick,fill=black!30,anchor=base]{#1};}
\newcommand{\tikztag}[1]{\tikz[baseline] \node [coordinate] (#1) {};}
